<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floatplane for webOS</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div id="app" class="app">
        <header class="app-header safe-zone">
            <div class="app-header__brand">
                <span class="app-logo" aria-hidden="true">FP</span>
                <div class="app-title">
                    <h1>Floatplane</h1>
                    <p>Unofficial webOS TV Client</p>
                </div>
            </div>
            <div class="app-header__status" id="statusBar">
                <div class="status-item">
                    <span class="status-label">User</span>
                    <span id="statusUser" class="status-value">Not signed in</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Network</span>
                    <span id="statusNetwork" class="status-value status-offline">Offline</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Mode</span>
                    <span id="statusMode" class="status-value">Splash</span>
                </div>
            </div>
        </header>

        <main class="app-main">
            <section class="screen screen-login is-active" data-screen="login" aria-labelledby="loginTitle">
                <div class="safe-zone login-layout">
                    <div class="login-panel">
                        <h2 id="loginTitle" class="screen-heading">Sign in to Floatplane</h2>
                        <p class="screen-subheading">Use your Floatplane credentials to continue.</p>
                        <form id="loginForm" class="login-form" novalidate>
                            <label for="loginEmail" class="input-label">Email address</label>
                            <input id="loginEmail"
                                   name="email"
                                   type="email"
                                   autocomplete="username"
                                   inputmode="email"
                                   data-focusable="true"
                                   data-focus-group="login"
                                   class="input-field"
                                   required>

                            <label for="loginPassword" class="input-label">Password</label>
                            <input id="loginPassword"
                                   name="password"
                                   type="password"
                                   autocomplete="current-password"
                                   data-focusable="true"
                                   data-focus-group="login"
                                   class="input-field"
                                   required>

                            <div id="twoFactorField" class="two-factor-field hidden">
                                <label for="loginTwoFactor" class="input-label">Two-factor code</label>
                                <input id="loginTwoFactor"
                                       name="twoFactor"
                                       type="tel"
                                       inputmode="numeric"
                                       pattern="[0-9]*"
                                       maxlength="6"
                                       data-focusable="true"
                                       data-focus-group="login"
                                       class="input-field">
                            </div>

                            <div id="turnstileWidget"
                                 class="turnstile-container"
                                 aria-live="polite">
                            </div>

                            <div class="button-row">
                                <button type="submit"
                                        class="btn btn-primary"
                                        data-focusable="true"
                                        data-focus-group="login-buttons"
                                        data-action="login-submit">
                                    Sign In
                                </button>
                                <button type="button"
                                        id="useSampleData"
                                        class="btn btn-secondary"
                                        data-focusable="true"
                                        data-focus-group="login-buttons"
                                        data-action="login-sample">
                                    Use Sample Data
                                </button>
                            </div>

                            <p class="login-disclaimer">
                                Remote tips: Use arrow keys to move, OK to submit, BACK to exit.
                            </p>
                        </form>
                    </div>

                    <aside class="login-hints">
                        <h3 class="hint-heading">Why Floatplane on TV?</h3>
                        <ul class="hint-list">
                            <li>Browse creator feeds optimized for the couch.</li>
                            <li>Resume where you left off with automatic progress tracking.</li>
                            <li>Switch between live streams and VOD effortlessly.</li>
                        </ul>
                        <div class="hint-callout">
                            Developer mode must stay active on your LG TV for deployment.
                        </div>
                    </aside>
                </div>
            </section>

            <section class="screen screen-home" data-screen="home" aria-labelledby="homeTitle">
                <div class="safe-zone home-layout">
                    <div class="home-sidebar">
                        <h2 id="homeTitle" class="screen-heading">Subscribed Creators</h2>
                        <div id="creatorList"
                             class="creator-list"
                             data-focus-group="creators"
                             role="list">
                        </div>
                    </div>

                    <div class="home-main">
                        <div class="home-header">
                            <div>
                                <h3 id="homeCreatorName" class="creator-name">Select a creator</h3>
                                <p id="homeCreatorDescription" class="creator-description">Creator details appear here when focused.</p>
                            </div>
                            <div class="home-actions" role="toolbar" aria-label="Home actions">
                                <button id="refreshButton"
                                        class="btn btn-tertiary"
                                        data-focusable="true"
                                        data-focus-group="home-actions"
                                        data-action="refresh-content">
                                    Refresh
                                </button>
                                <button id="logoutButton"
                                        class="btn btn-secondary"
                                        data-focusable="true"
                                        data-focus-group="home-actions"
                                        data-action="logout">
                                    Sign Out
                                </button>
                            </div>
                        </div>

                        <div class="home-content">
                            <div id="videoGrid"
                                 class="video-grid"
                                 data-focus-group="videos"
                                 role="list"
                                 aria-label="Available videos">
                            </div>

                            <div class="content-details">
                                <div class="content-details__header">
                                    <h3 id="videoTitle" class="video-title">Focus a video for details</h3>
                                    <span id="videoLiveBadge" class="badge badge-live hidden">LIVE</span>
                                </div>
                                <p id="videoDescription" class="video-description">
                                    Use the arrow keys to browse videos. Press OK to play. Resume progress is offered automatically.
                                </p>
                                <div class="content-meta">
                                    <span id="videoDuration" class="meta-item">Duration —</span>
                                    <span id="videoPublished" class="meta-item">Published —</span>
                                </div>
                                <div class="content-actions" role="group">
                                    <button id="playButton"
                                            class="btn btn-primary"
                                            data-focusable="true"
                                            data-focus-group="content-actions"
                                            data-action="play-selected"
                                            disabled>
                                        Play
                                    </button>
                                    <button id="resumeButton"
                                            class="btn btn-secondary"
                                            data-focusable="true"
                                            data-focus-group="content-actions"
                                            data-action="resume-selected"
                                            disabled>
                                        Resume
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="screen screen-player" data-screen="player" aria-label="Video player view">
                <div class="player-safe-zone">
                    <div id="playerContainer" class="player-container">
                        <video id="videoElement"
                               class="player-video"
                               preload="metadata"
                               tabindex="-1">
                               Sorry, your TV does not support HTML5 video.
                        </video>

                        <div id="playerOverlay" class="player-overlay">
                            <div class="player-top-bar">
                                <div>
                                    <h3 id="playerVideoTitle" class="player-title">Now Playing</h3>
                                    <p id="playerCreatorName" class="player-subtitle">Creator name</p>
                                </div>
                                <div class="player-status">
                                    <span id="playerLiveIndicator" class="badge badge-live hidden">LIVE</span>
                                    <span id="playerTimecode" class="player-timecode">00:00 / 00:00</span>
                                </div>
                            </div>

                            <div class="player-controls" role="toolbar" aria-label="Playback controls">
                                <button id="playerPlayPause"
                                        class="btn-icon"
                                        data-focusable="true"
                                        data-focus-group="player-controls"
                                        data-action="toggle-play">
                                    ⏯
                                </button>
                                <button id="playerSeekBackward"
                                        class="btn-icon"
                                        data-focusable="true"
                                        data-focus-group="player-controls"
                                        data-action="seek-back">
                                    ⏪ 10s
                                </button>
                                <button id="playerSeekForward"
                                        class="btn-icon"
                                        data-focusable="true"
                                        data-focus-group="player-controls"
                                        data-action="seek-forward">
                                    ⏩ 10s
                                </button>
                    <button id="playerJumpToLive"
                            class="btn btn-tertiary hidden"
                            data-focusable="true"
                            data-focus-group="player-controls"
                            data-action="jump-to-live">
                        Go Live
                    </button>
                                <div class="player-control-split">
                                    <button id="playerQualityButton"
                                            class="btn btn-tertiary"
                                            data-focusable="true"
                                            data-focus-group="player-controls"
                                            data-action="open-quality">
                                        Quality: Auto
                                    </button>
                                    <div id="qualityMenu"
                                         class="quality-menu hidden"
                                         role="menu"
                                         aria-label="Select quality"
                                         data-focus-group="quality">
                                    </div>
                                </div>
                                <button id="playerExitButton"
                                        class="btn btn-secondary"
                                        data-focusable="true"
                                        data-focus-group="player-controls"
                                        data-action="exit-player">
                                    Exit
                                </button>
                                <button id="playerModeToggle"
                                        class="btn btn-tertiary"
                                        data-focusable="true"
                                        data-focus-group="player-controls"
                                        data-action="toggle-viewing-mode">
                                    Mode
                                </button>
                                <button id="playerChatToggle"
                                        class="btn btn-tertiary"
                                        data-focusable="true"
                                        data-focus-group="player-controls"
                                        data-action="toggle-chat">
                                    Chat
                                </button>
                            </div>
                        </div>
                    </div>
                    <aside id="playerSidebar" class="player-sidebar" aria-live="polite">
                        <div class="mode-indicator" id="viewingModeIndicator">Theater</div>
                        <section id="chatPanel" class="chat-panel" data-visible="false" data-enabled="false" aria-label="Live chat">
                            <header class="chat-header">
                                <h3>Live Chat</h3>
                                <div class="chat-actions">
                                    <span id="chatViewerCount" class="viewer-count">👁 0</span>
                                    <button id="chatCloseButton"
                                            class="btn-icon"
                                            data-focusable="true"
                                            data-focus-group="chat-controls"
                                            data-action="toggle-chat">
                                        ✕
                                    </button>
                                </div>
                            </header>
                            <div id="chatMessages" class="chat-messages" role="log"></div>
                            <footer class="chat-input" id="chatInputArea" data-enabled="false">
                                <input id="chatMessageInput"
                                       type="text"
                                       maxlength="240"
                                       placeholder="Send a message..."
                                       data-focusable="true"
                                       data-focus-group="chat-input" />
                                <button id="chatSendButton"
                                        class="btn btn-primary"
                                        data-focusable="true"
                                        data-focus-group="chat-input"
                                        data-action="send-chat">
                                    Send
                                </button>
                            </footer>
                        </section>
                    </aside>
                </div>
            </section>
        </main>

        <div id="toast" class="toast" role="status" aria-live="polite"></div>

        <div id="globalLoader" class="global-loader hidden" role="status" aria-live="assertive">
            <div class="loader-spinner"></div>
            <p>Loading</p>
        </div>
    </div>

    <script src="webOSTVjs/webOSTV.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.3.6/dist/shaka-player.compiled.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="scripts/core/logger.js"></script>
    <script src="scripts/core/screen-logger.js"></script>
    <script src="scripts/utils/storage.js"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="scripts/utils/http.js"></script>
    <script src="scripts/utils/throttle.js"></script>
    <script src="scripts/utils/memory-monitor.js"></script>
    <script src="scripts/services/floatplane-api-client.js"></script>
    <script src="scripts/player/shaka-controller.js"></script>
    <script src="scripts/services/auth-service.js"></script>
    <script src="scripts/services/content-service.js"></script>
    <script src="scripts/services/chat-service.js"></script>
    <script src="scripts/ui/viewing-mode-manager.js"></script>
    <script src="scripts/main.js"></script>
</body>
</html>
